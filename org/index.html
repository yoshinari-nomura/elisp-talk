<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
<head>
<title>Emacs Lisp を書いてみたい人へ</title>
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Yoshinari Nomura" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="pub/css/text.css" /><script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="index.html"> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="content">
<h1 class="title">Emacs Lisp を書いてみたい人へ</h1>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
$(function() {
  $("pre[id^=ans-]").each(function() {
    var code = $(this);
    var link = $('<a href="javascript:void(0);">toggle code</a>');
    code.hide();
    link.insertBefore(code);
    link.on('click', function(e){code.toggle();});
  });
});
/*]]>*///-->
</script>


<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> 準備</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">キーバインド</h3>
<div class="outline-text-3" id="text-1-1">
<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">C-h is BS, C-d is DEL</span>
(load-library <span style="color: #8b2252;">"term/bobcat"</span>)
(terminal-init-bobcat)
(setq normal-erase-is-backspace nil)

<span style="color: #b22222;">;; </span><span style="color: #b22222;">C-zh to help</span>
(global-unset-key <span style="color: #8b2252;">"\C-z"</span>)
(global-set-key <span style="color: #8b2252;">"\C-zh"</span> 'help)
(global-set-key <span style="color: #8b2252;">"\C-z\C-z"</span> 'suspend-emacs)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">Emacs Server</h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">server</span>)

(<span style="color: #a020f0;">unless</span> (server-running-p)
  (server-start))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3">cask (package management)</h3>
<div class="outline-text-3" id="text-1-3">
<ul class="org-ul">
<li><a href="https://github.com/cask/cask">https://github.com/cask/cask</a>
</li>
<li><a href="http://cask.readthedocs.org">http://cask.readthedocs.org</a>
</li>
</ul>

<p>
In your terminal:
</p>
<div class="org-src-container">

<pre class="src src-sh">curl -fsSL https://raw.githubusercontent.com/cask/cask/master/go | python
</pre>
</div>

<p>
Add to your .zshenv:
</p>
<div class="org-src-container">

<pre class="src src-shell-script"><span style="color: #a0522d;">path</span>=(~/.cask/bin $<span style="color: #a0522d;">path</span>)
</pre>
</div>

<p>
Add to your .emacs:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">cask</span> <span style="color: #8b2252;">"~/.cask/cask.el"</span>)
(cask-initialize)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4">ヘルプ関連</h3>
<div class="outline-text-3" id="text-1-4">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(add-hook 'emacs-lisp-mode-hook 'eldoc-mode)
(add-hook 'lisp-interaction-mode-hook 'eldoc-mode)
(add-hook 'ielm-mode-hook 'eldoc-mode)
(add-hook 'eval-expression-minibuffer-setup-hook 'eldoc-mode)
(define-key goto-map <span style="color: #8b2252;">"f"</span> 'find-function)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5" class="outline-3">
<h3 id="sec-1-5">便利そうな機能のおさらい</h3>
<div class="outline-text-3" id="text-1-5">
<ul class="org-ul">
<li>M-x toggle-debug-on-error
</li>
<li>M-x apropos
</li>
<li>M-x find-function
</li>
<li>M-x describe-{bindings,function,variable,key}
</li>
<li>M-x kmacro-start-macro <code>C-x(</code>
</li>
<li>M-x kmacro-{start,end} <code>C-x(</code>, <code>C-x)</code>
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Emacs Lisp 入門</h2>
<div class="outline-text-2" id="text-2">
<p>
この2つを参考に自学してください
</p>
<ol class="org-ol">
<li><a href="http://yohshiy.blog.fc2.com/blog-entry-265.html">環境設定のための Emacs Lisp 入門</a>
</li>
<li><a href="http://www.math.s.chiba-u.ac.jp/~matsu/lisp/emacs-lisp-intro-jp_toc.html">Programming in Emacs Lisp</a>
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Emacs Lisp で作る前に</h2>
<div class="outline-text-2" id="text-3">
<ol class="org-ol">
<li>普通の Emacs の使い方をマスタしよう
<ul class="org-ul">
<li>Emacs をある程度使いこなせないなら，Emacs Lisp を書く理由がない
</li>
<li>標準機能の改良から初めよう (tetris のキーバインドが気に入らない)
</li>
</ul>
</li>

<li>チュートリアルを終えたら，我慢してマニュアルを一通り読もう
<ul class="org-ul">
<li><a href="http://www.gnu.org/software/emacs/manual/elisp.html">http://www.gnu.org/software/emacs/manual/elisp.html</a>
</li>
<li><a href="http://www.bookshelf.jp/texi/elisp-manual/21-2-8/jp/elisp.html">http://www.bookshelf.jp/texi/elisp-manual/21-2-8/jp/elisp.html</a> (邦訳)
</li>
</ul>
<p>
目を通しておくだけで違う．週末の午後を2日ぐら使って一通り読むぐらいのイメージ
</p>
</li>

<li>何でも Emacs Lisp だけでやろうとしない
<ul class="org-ul">
<li>Shell script 書いた方が早くないですか?
</li>

<li>他のプロセスやサービスのフロントエンドとして Emacs を使う
<ul class="org-ul">
<li>ispell, flycheck, mew, mhc, jay, grammer.el
</li>
</ul>
</li>
</ul>
</li>

<li>Emacs をむやみに終了しない
<ul class="org-ul">
<li>起動に時間がかかる
</li>
<li>各種履歴，mark位置，バッファ一覧，scratch等々が消えると面倒
</li>
</ul>
</li>

<li>buffer を1つの環境(スコープ，記憶領域，ワークスペース)として利用する
<ul class="org-ul">
<li>ファイルに結び付かないバッファを利用する
</li>
<li>Emacs の挙動を変える変数は，buffer-local のスコープを持つことが多い
<ul class="org-ul">
<li>例: truncate-lines
</li>
</ul>
</li>
<li><b>モード</b> という考え方は，バッファ単位に結び付く
</li>
<li>複雑な文字列操作などの場合に裏で一時的なバッファを開いてそこで作業する <code>with-temp-buffer</code>
</li>
</ul>
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> 小さな elisp 関数の例</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1">コード</h3>
<div class="outline-text-3" id="text-4-1">
<p>
<a href="dyn/my-funcs.el">my-funcs.el</a>
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp" id="ans-my-funcs"><span class="linenr">  1: </span><span style="color: #b22222;">;;; </span><span style="color: #b22222;">10-my-functions.el --- Tips.</span>
<span class="linenr">  2: </span>
<span class="linenr">  3: </span><span style="color: #b22222;">;; </span><span style="color: #b22222;">Author:  Yoshinari Nomura</span>
<span class="linenr">  4: </span><span style="color: #b22222;">;; </span><span style="color: #b22222;">Created: 2005-03-27</span>
<span class="linenr">  5: </span><span style="color: #b22222;">;; </span><span style="color: #b22222;">Revised Time-stamp: &lt;2015-07-27 08:26:21 JST&gt;</span>
<span class="linenr">  6: </span>
<span class="linenr">  7: </span><span style="color: #b22222;">;;; </span><span style="color: #b22222;">Commentary:</span>
<span class="linenr">  8: </span>
<span class="linenr">  9: </span><span style="color: #b22222;">;;; </span><span style="color: #b22222;">Code:</span>
<span class="linenr"> 10: </span>
<span class="linenr"> 11: </span><span style="color: #b22222;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr"> 12: </span><span style="color: #b22222;">;; </span><span style="color: #b22222;">general functions.</span>
<span class="linenr"> 13: </span><span style="color: #b22222;">;;</span>
<span class="linenr"> 14: </span>
<span class="linenr"> 15: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">insert-file-or-filename</span> (filename p)
<span class="linenr"> 16: </span>  (interactive <span style="color: #8b2252;">"*fInsert file: \nP"</span>)
<span class="linenr"> 17: </span>  (<span style="color: #a020f0;">if</span> p
<span class="linenr"> 18: </span>      (insert (file-relative-name filename))
<span class="linenr"> 19: </span>    (insert-file filename)))
<span class="linenr"> 20: </span>
<span class="linenr"> 21: </span>
<span class="linenr"> 22: </span><span style="color: #b22222;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr"> 23: </span><span style="color: #b22222;">;;; </span><span style="color: #b22222;">for change log memo (cmemo)</span>
<span class="linenr"> 24: </span>
<span class="linenr"> 25: </span>(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">browse-url</span>)
<span class="linenr"> 26: </span>
<span class="linenr"> 27: </span>(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">cmemo-path</span>                (expand-file-name <span style="color: #8b2252;">"~/prj/private/"</span>))
<span class="linenr"> 28: </span>(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">cmemo-filename</span>            <span style="color: #8b2252;">"ChangeLog"</span>)
<span class="linenr"> 29: </span>(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">cmemo-default-category</span>    <span style="color: #8b2252;">"Private"</span>)
<span class="linenr"> 30: </span>(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">cmemo-input-category-hist</span> ())
<span class="linenr"> 31: </span>
<span class="linenr"> 32: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">cmemo/get-category-completion-list</span> ()
<span class="linenr"> 33: </span>  (<span style="color: #a020f0;">let</span> ((str) (category-list ()))
<span class="linenr"> 34: </span>    (<span style="color: #a020f0;">with-current-buffer</span>
<span class="linenr"> 35: </span>        (find-file-noselect (expand-file-name cmemo-filename cmemo-path))
<span class="linenr"> 36: </span>      (goto-char (point-min))
<span class="linenr"> 37: </span>      (<span style="color: #a020f0;">while</span> (re-search-forward <span style="color: #8b2252;">"^[ \t]*\\*[ \t]*(</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">(</span><span style="color: #8b2252;">.*</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">)</span><span style="color: #8b2252;">):"</span> nil t)
<span class="linenr"> 38: </span>        (setq str (buffer-substring (match-beginning 1) (match-end 1)))
<span class="linenr"> 39: </span>        (<span style="color: #a020f0;">if</span> (not (assoc str category-list))
<span class="linenr"> 40: </span>            (setq category-list
<span class="linenr"> 41: </span>                  (cons (cons str str) category-list)))))
<span class="linenr"> 42: </span>    category-list))
<span class="linenr"> 43: </span>
<span class="linenr"> 44: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">cmemo-input-category</span> ()
<span class="linenr"> 45: </span>  (completing-read
<span class="linenr"> 46: </span>   (format <span style="color: #8b2252;">"Category (%s) : "</span> cmemo-default-category)
<span class="linenr"> 47: </span>   (cmemo/get-category-completion-list)
<span class="linenr"> 48: </span>   nil nil nil
<span class="linenr"> 49: </span>   'cmemo-input-category-hist cmemo-default-category))
<span class="linenr"> 50: </span>
<span class="linenr"> 51: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">cmemo</span> ()
<span class="linenr"> 52: </span>  (interactive)
<span class="linenr"> 53: </span>  (<span style="color: #a020f0;">let</span> ((add-log-current-defun-function    'cmemo-input-category)
<span class="linenr"> 54: </span>        <span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-log-buffer-file-name-function (lambda (x) "")) ;; emacs 20</span>
<span class="linenr"> 55: </span>        (add-log-buffer-file-name-function (<span style="color: #a020f0;">lambda</span> () <span style="color: #8b2252;">""</span>))
<span class="linenr"> 56: </span>        (add-log-file-name-function        (<span style="color: #a020f0;">lambda</span> (x) <span style="color: #8b2252;">""</span>)))
<span class="linenr"> 57: </span>    (add-change-log-entry
<span class="linenr"> 58: </span>     nil
<span class="linenr"> 59: </span>     (expand-file-name cmemo-filename cmemo-path) t t)))
<span class="linenr"> 60: </span>
<span class="linenr"> 61: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">cmemo-get-url-at-point</span> ()
<span class="linenr"> 62: </span>  (interactive)
<span class="linenr"> 63: </span>  (<span style="color: #a020f0;">let</span> ((url (browse-url-url-at-point)))
<span class="linenr"> 64: </span>    (<span style="color: #a020f0;">if</span> url
<span class="linenr"> 65: </span>        (<span style="color: #a020f0;">progn</span>
<span class="linenr"> 66: </span>          (kill-new url)
<span class="linenr"> 67: </span>          (message url)
<span class="linenr"> 68: </span>          url))))
<span class="linenr"> 69: </span>
<span class="linenr"> 70: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">cmemo-add-url-at-point</span> ()
<span class="linenr"> 71: </span>  (interactive)
<span class="linenr"> 72: </span>  (<span style="color: #a020f0;">let</span> ((url (cmemo-get-url-at-point)))
<span class="linenr"> 73: </span>    (cmemo)
<span class="linenr"> 74: </span>    (<span style="color: #a020f0;">if</span> url (insert url))))
<span class="linenr"> 75: </span>
<span class="linenr"> 76: </span><span style="color: #b22222;">;;</span><span style="color: #b22222;">(defalias 'log 'cmemo-add-url-at-point)</span>
<span class="linenr"> 77: </span>
<span class="linenr"> 78: </span><span style="color: #b22222;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr"> 79: </span><span style="color: #b22222;">;; </span><span style="color: #b22222;">browse-url</span>
<span class="linenr"> 80: </span>
<span class="linenr"> 81: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">browse-address-of-region</span> (min max)
<span class="linenr"> 82: </span>  <span style="color: #8b2252;">"Ask a WWW browser to display the current region."</span>
<span class="linenr"> 83: </span>  (interactive <span style="color: #8b2252;">"r"</span>)
<span class="linenr"> 84: </span>  (<span style="color: #a020f0;">save-excursion</span>
<span class="linenr"> 85: </span>    (<span style="color: #a020f0;">save-restriction</span>
<span class="linenr"> 86: </span>      (browse-url (concat <span style="color: #8b2252;">"http://maps.google.com?q="</span>
<span class="linenr"> 87: </span>                          (buffer-substring min max))))))
<span class="linenr"> 88: </span>
<span class="linenr"> 89: </span><span style="color: #b22222;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr"> 90: </span><span style="color: #b22222;">;; </span><span style="color: #b22222;">MEMO, ADDRESS, TODO</span>
<span class="linenr"> 91: </span>
<span class="linenr"> 92: </span>(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">mydocument-path</span> (expand-file-name <span style="color: #8b2252;">"~/prj/private/"</span>))
<span class="linenr"> 93: </span>
<span class="linenr"> 94: </span>(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">diary-file-name</span> <span style="color: #8b2252;">"~/prj/diary/days%y%m.html"</span>)
<span class="linenr"> 95: </span>(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">diary-photo-dir</span> <span style="color: #8b2252;">"~/prj/diary/img"</span>)
<span class="linenr"> 96: </span>
<span class="linenr"> 97: </span>(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">todo-file-name</span> <span style="color: #8b2252;">"org/TODO.org"</span>)
<span class="linenr"> 98: </span>(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">memo-file-name</span>  <span style="color: #8b2252;">"MEMO.org"</span>)
<span class="linenr"> 99: </span>(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">log-file-name</span>  <span style="color: #8b2252;">"ChangeLog.txt"</span>)
<span class="linenr">100: </span>(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">address-file-name</span> <span style="color: #8b2252;">"ADDRESS.org"</span>)
<span class="linenr">101: </span>(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">journal-file-name</span> <span style="color: #8b2252;">"org/Journal.org"</span>)
<span class="linenr">102: </span>(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">index-file-name</span> <span style="color: #8b2252;">"org/index.org"</span>)
<span class="linenr">103: </span>
<span class="linenr">104: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">find-mydoc-file-other-window</span> (filename)
<span class="linenr">105: </span>  (find-file-other-window
<span class="linenr">106: </span>   (concat mydocument-path filename))
<span class="linenr">107: </span>  (message <span style="color: #8b2252;">""</span>))
<span class="linenr">108: </span>
<span class="linenr">109: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">blog</span> ()
<span class="linenr">110: </span>  (interactive)
<span class="linenr">111: </span>  (find-file <span style="color: #8b2252;">"~/prj/vendor/octopress/org/blog"</span>))
<span class="linenr">112: </span>
<span class="linenr">113: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">todo</span> ()
<span class="linenr">114: </span>  (interactive)
<span class="linenr">115: </span>  (find-mydoc-file-other-window todo-file-name))
<span class="linenr">116: </span>
<span class="linenr">117: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">address</span> ()
<span class="linenr">118: </span>  (interactive)
<span class="linenr">119: </span>  (find-mydoc-file-other-window address-file-name))
<span class="linenr">120: </span>
<span class="linenr">121: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">memo</span> ()
<span class="linenr">122: </span>  (interactive)
<span class="linenr">123: </span>  (find-mydoc-file-other-window memo-file-name))
<span class="linenr">124: </span>
<span class="linenr">125: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">journal</span> ()
<span class="linenr">126: </span>  (interactive)
<span class="linenr">127: </span>  (find-mydoc-file-other-window journal-file-name))
<span class="linenr">128: </span>
<span class="linenr">129: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">index</span> ()
<span class="linenr">130: </span>  (interactive)
<span class="linenr">131: </span>  (find-mydoc-file-other-window index-file-name))
<span class="linenr">132: </span>
<span class="linenr">133: </span><span style="color: #b22222;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">134: </span><span style="color: #b22222;">;; </span><span style="color: #b22222;">diary</span>
<span class="linenr">135: </span>
<span class="linenr">136: </span>(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">diary-entry-regex</span> <span style="color: #8b2252;">"name=.?</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">(</span><span style="color: #8b2252;">[0-9]+/[0-9]+/[0-9]+</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">|</span><span style="color: #8b2252;">last</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">)</span><span style="color: #8b2252;">.?"</span>)
<span class="linenr">137: </span>(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">diary-file-name</span> <span style="color: #8b2252;">"~/prj/diary/days%y%m.html"</span>)
<span class="linenr">138: </span>
<span class="linenr">139: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">diary-insert-date-header</span> (<span style="color: #228b22;">&amp;optional</span> date)
<span class="linenr">140: </span>  (interactive)
<span class="linenr">141: </span>  (mhc-date-let (or date (car (mhc-input-day)) (mhc-date-now))
<span class="linenr">142: </span>    (insert
<span class="linenr">143: </span>     (format
<span class="linenr">144: </span>      (concat <span style="color: #8b2252;">"&lt;h2 class=\"%s\"&gt;&lt;a name=\"%04d/%02d/%02d\"&gt;"</span>
<span class="linenr">145: </span>              <span style="color: #8b2252;">"%04d&#24180;%02d&#26376;%02d&#26085;(%s)&lt;/a&gt;&lt;/h2&gt;\n"</span>)
<span class="linenr">146: </span>      (downcase (mhc-date-digit-to-ww-string ww)) yy mm dd
<span class="linenr">147: </span>      yy mm dd (mhc-date-digit-to-ww-japanese-string ww)))))
<span class="linenr">148: </span>
<span class="linenr">149: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">diary-get-region-date</span> ()
<span class="linenr">150: </span>  (<span style="color: #a020f0;">save-excursion</span>
<span class="linenr">151: </span>    (<span style="color: #a020f0;">if</span> (re-search-backward <span style="color: #8b2252;">"name=.?</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">(</span><span style="color: #8b2252;">[0-9]+/[0-9]+/[0-9]+</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">|</span><span style="color: #8b2252;">last</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">)</span><span style="color: #8b2252;">.?"</span> nil t)
<span class="linenr">152: </span>        (mhc-date-new-from-string2
<span class="linenr">153: </span>         (buffer-substring (match-beginning 1) (match-end 1)) nil t))))
<span class="linenr">154: </span>
<span class="linenr">155: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">diary-get-last-date</span> ()
<span class="linenr">156: </span>  (<span style="color: #a020f0;">save-excursion</span>
<span class="linenr">157: </span>    (goto-char (point-max))
<span class="linenr">158: </span>    (<span style="color: #a020f0;">if</span> (re-search-backward <span style="color: #8b2252;">"name=.?</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">(</span><span style="color: #8b2252;">[0-9]+/[0-9]+/[0-9]+</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">)</span><span style="color: #8b2252;">.?"</span> nil t)
<span class="linenr">159: </span>        (mhc-date-new-from-string2
<span class="linenr">160: </span>         (buffer-substring (match-beginning 1) (match-end 1)) nil t))))
<span class="linenr">161: </span>
<span class="linenr">162: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">diary</span> (<span style="color: #228b22;">&amp;optional</span> p)
<span class="linenr">163: </span>  (interactive <span style="color: #8b2252;">"p"</span>)
<span class="linenr">164: </span>  (<span style="color: #a020f0;">let</span> ((filename (format-time-string diary-file-name))
<span class="linenr">165: </span>        (last-date <span style="color: #8b2252;">""</span>))
<span class="linenr">166: </span>    (find-file-other-window filename)
<span class="linenr">167: </span>    (goto-char (point-max))
<span class="linenr">168: </span>    (re-search-backward <span style="color: #8b2252;">"name=\"last\""</span> nil t)
<span class="linenr">169: </span>    (forward-line -1)
<span class="linenr">170: </span>    (<span style="color: #a020f0;">if</span> (and (diary-get-region-date)
<span class="linenr">171: </span>             (mhc-date= (mhc-date-now) (diary-get-region-date)))
<span class="linenr">172: </span>        ()
<span class="linenr">173: </span>      <span style="color: #b22222;">;;</span><span style="color: #b22222;">(diary-insert-date-header)</span>
<span class="linenr">174: </span>      (insert <span style="color: #8b2252;">"\n"</span>))))
<span class="linenr">175: </span>
<span class="linenr">176: </span><span style="color: #b22222;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">177: </span><span style="color: #b22222;">;;; </span><span style="color: #b22222;">numbering</span>
<span class="linenr">178: </span>
<span class="linenr">179: </span>(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">numbering-default-string</span> <span style="color: #8b2252;">"^[\t &#12288;]*(</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">(</span><span style="color: #8b2252;"> *[0-9]+</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">)</span><span style="color: #8b2252;">)"</span>)
<span class="linenr">180: </span>
<span class="linenr">181: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">numbering</span> (<span style="color: #228b22;">&amp;optional</span> arg)
<span class="linenr">182: </span>  (interactive)
<span class="linenr">183: </span>  (<span style="color: #a020f0;">let</span> ((n 1))
<span class="linenr">184: </span>    (<span style="color: #a020f0;">save-excursion</span>
<span class="linenr">185: </span>      (setq numbering-default-string
<span class="linenr">186: </span>            (read-from-minibuffer (format <span style="color: #8b2252;">"Numbering format (%s):"</span>
<span class="linenr">187: </span>                                          numbering-default-string)
<span class="linenr">188: </span>                                  numbering-default-string))
<span class="linenr">189: </span>      (goto-char (point-min))
<span class="linenr">190: </span>      (<span style="color: #a020f0;">while</span> (re-search-forward numbering-default-string nil t)
<span class="linenr">191: </span>        (replace-match (format <span style="color: #8b2252;">"%02d"</span> n) nil nil nil 1)
<span class="linenr">192: </span>        (setq n (1+ n)))
<span class="linenr">193: </span>      )))
<span class="linenr">194: </span>
<span class="linenr">195: </span>
<span class="linenr">196: </span><span style="color: #b22222;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">197: </span><span style="color: #b22222;">;;; </span><span style="color: #b22222;">sum up numbers in a string, region or rectangle.</span>
<span class="linenr">198: </span>
<span class="linenr">199: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">sum-string</span> (string)
<span class="linenr">200: </span>  (<span style="color: #a020f0;">let</span> ((str <span style="color: #8b2252;">""</span>) (sum 0))
<span class="linenr">201: </span>    (mapc
<span class="linenr">202: </span>     (<span style="color: #a020f0;">lambda</span> (c)
<span class="linenr">203: </span>       (<span style="color: #a020f0;">cond</span>
<span class="linenr">204: </span>        ((char-equal c ?,)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">skip comma</span>
<span class="linenr">205: </span>        ((string-match <span style="color: #8b2252;">"[0-9.+-]"</span> (char-to-string c))
<span class="linenr">206: </span>         (setq str (format <span style="color: #8b2252;">"%s%c"</span> str c)))
<span class="linenr">207: </span>        (t (setq sum (+ sum (string-to-number str)) str <span style="color: #8b2252;">""</span>))))
<span class="linenr">208: </span>     (concat string <span style="color: #8b2252;">"X"</span>))
<span class="linenr">209: </span>    sum))
<span class="linenr">210: </span>
<span class="linenr">211: </span>(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">sum-money-regexp</span> <span style="color: #8b2252;">"</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">(</span><span style="color: #8b2252;">[0-9,]+</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">)</span><span style="color: #8b2252;">&#20870;"</span>)
<span class="linenr">212: </span>
<span class="linenr">213: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">sum-string-to-int</span> (string)
<span class="linenr">214: </span>  (sum-string string))
<span class="linenr">215: </span>
<span class="linenr">216: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">sum-money-in-region</span> (p1 p2)
<span class="linenr">217: </span>  (interactive <span style="color: #8b2252;">"r"</span>)
<span class="linenr">218: </span>  (<span style="color: #a020f0;">let</span> ((sum 0))
<span class="linenr">219: </span>    (<span style="color: #a020f0;">save-excursion</span>
<span class="linenr">220: </span>      (goto-char p1)
<span class="linenr">221: </span>      (<span style="color: #a020f0;">save-match-data</span>
<span class="linenr">222: </span>        (<span style="color: #a020f0;">while</span> (re-search-forward sum-money-regexp p2 t)
<span class="linenr">223: </span>          (setq sum (+ sum (sum-string-to-int (match-string 1)))))))
<span class="linenr">224: </span>    (insert (format <span style="color: #8b2252;">"[&#21512;&#35336;: %d]"</span> sum))))
<span class="linenr">225: </span>
<span class="linenr">226: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">sum-region</span> (p1 p2)
<span class="linenr">227: </span>  (interactive <span style="color: #8b2252;">"r"</span>)
<span class="linenr">228: </span>  (insert (format <span style="color: #8b2252;">"[&#21512;&#35336;: %d]"</span> (sum-string (buffer-substring p1 p2)))))
<span class="linenr">229: </span>
<span class="linenr">230: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">sum-rectangle</span> (p1 p2)
<span class="linenr">231: </span>  (interactive <span style="color: #8b2252;">"r"</span>)
<span class="linenr">232: </span>  (<span style="color: #a020f0;">let</span> ((sum 0) (rect (extract-rectangle p1 p2)))
<span class="linenr">233: </span>    (mapc (<span style="color: #a020f0;">lambda</span> (s) (setq sum (+ sum (sum-string s)))) rect)
<span class="linenr">234: </span>    (insert (format <span style="color: #8b2252;">"[&#21512;&#35336;: %d]"</span> sum))))
<span class="linenr">235: </span>
<span class="linenr">236: </span><span style="color: #b22222;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">237: </span><span style="color: #b22222;">;;; </span><span style="color: #b22222;">Time and Date.</span>
<span class="linenr">238: </span>
<span class="linenr">239: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">make-timetable</span> (<span style="color: #228b22;">&amp;optional</span> duration-minutes interval-minutes)
<span class="linenr">240: </span>  (interactive)
<span class="linenr">241: </span>  (<span style="color: #a020f0;">let</span> ((time-start nil) (time-end nil) hh mm)
<span class="linenr">242: </span>    (setq duration-minutes
<span class="linenr">243: </span>          (or duration-minutes
<span class="linenr">244: </span>              (string-to-number (read-from-minibuffer <span style="color: #8b2252;">"Frequency (minute): "</span>))))
<span class="linenr">245: </span>    (setq interval-minutes
<span class="linenr">246: </span>          (or interval-minutes
<span class="linenr">247: </span>              (string-to-number (read-from-minibuffer <span style="color: #8b2252;">"Interval (minute): "</span>))))
<span class="linenr">248: </span>
<span class="linenr">249: </span>    (<span style="color: #a020f0;">while</span> (looking-at <span style="color: #8b2252;">"</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">(</span><span style="color: #8b2252;">[0-9]+</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">)</span><span style="color: #8b2252;">:</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">(</span><span style="color: #8b2252;">[0-9]+</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">)</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">(</span><span style="color: #8b2252;"> *- *[0-9]+:[0-9]+</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">)</span><span style="color: #8b2252;">?"</span>)
<span class="linenr">250: </span>      (setq hh (string-to-number
<span class="linenr">251: </span>                (buffer-substring (match-beginning 1) (match-end 1)))
<span class="linenr">252: </span>            mm (string-to-number
<span class="linenr">253: </span>                (buffer-substring (match-beginning 2) (match-end 2))))
<span class="linenr">254: </span>      (delete-region (match-beginning 0) (match-end 0))
<span class="linenr">255: </span>
<span class="linenr">256: </span>      (setq time-start
<span class="linenr">257: </span>            (<span style="color: #a020f0;">if</span> time-start
<span class="linenr">258: </span>                (+ time-start duration-minutes interval-minutes)
<span class="linenr">259: </span>              (+ (* hh 60) mm)))
<span class="linenr">260: </span>      (setq time-end (+ time-start duration-minutes))
<span class="linenr">261: </span>      (<span style="color: #a020f0;">save-excursion</span>
<span class="linenr">262: </span>        (insert (format <span style="color: #8b2252;">"%02d:%02d-%02d:%02d"</span>
<span class="linenr">263: </span>                        (/ time-start 60) (% time-start 60)
<span class="linenr">264: </span>                        (/ time-end 60) (% time-end 60))))
<span class="linenr">265: </span>      (next-line 1))))
<span class="linenr">266: </span>
<span class="linenr">267: </span>
<span class="linenr">268: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">fomat-time-string2</span> (fs <span style="color: #228b22;">&amp;optional</span> time universal)
<span class="linenr">269: </span>  (<span style="color: #a020f0;">let*</span> ((ww (string-to-number (format-time-string <span style="color: #8b2252;">"%u"</span> time universal)))
<span class="linenr">270: </span>         (jw (aref [<span style="color: #8b2252;">"&#26085;"</span> <span style="color: #8b2252;">"&#26376;"</span> <span style="color: #8b2252;">"&#28779;"</span> <span style="color: #8b2252;">"&#27700;"</span> <span style="color: #8b2252;">"&#26408;"</span> <span style="color: #8b2252;">"&#37329;"</span> <span style="color: #8b2252;">"&#22303;"</span>] ww)))))
<span class="linenr">271: </span>
<span class="linenr">272: </span>(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">insert-time-start-point</span> nil)
<span class="linenr">273: </span>
<span class="linenr">274: </span>(setq  insert-time-format-list
<span class="linenr">275: </span>  '(<span style="color: #8b2252;">"&lt;h2&gt;&lt;a name=\"%Y/%m/%d\"&gt;%Y&#24180; %m&#26376; %d&#26085;()&lt;/a&gt;&lt;/h2&gt;"</span>
<span class="linenr">276: </span>    <span style="color: #8b2252;">"%Y-%m-%d"</span>
<span class="linenr">277: </span>    <span style="color: #8b2252;">"%Y-%m-%d %H:%M:%S"</span>))
<span class="linenr">278: </span>
<span class="linenr">279: </span>(setq insert-time-format-index 0)
<span class="linenr">280: </span>
<span class="linenr">281: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">get-time-format</span> (order)
<span class="linenr">282: </span>  (setq insert-time-format-index
<span class="linenr">283: </span>        (<span style="color: #a020f0;">cond</span>
<span class="linenr">284: </span>         ((numberp  order)    order)
<span class="linenr">285: </span>         ((eq order 'next)    (1+ insert-time-format-index))
<span class="linenr">286: </span>         ((eq order 'current) insert-time-format-index)
<span class="linenr">287: </span>         (t                   0)))
<span class="linenr">288: </span>  (<span style="color: #a020f0;">if</span> (not (nth insert-time-format-index insert-time-format-list))
<span class="linenr">289: </span>      (setq insert-time-format-index 0))
<span class="linenr">290: </span>  (nth insert-time-format-index insert-time-format-list))
<span class="linenr">291: </span>
<span class="linenr">292: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">insert-time</span> (<span style="color: #228b22;">&amp;optional</span> time)
<span class="linenr">293: </span>  (interactive)
<span class="linenr">294: </span>  (<span style="color: #a020f0;">if</span> (eq last-command 'insert-time)
<span class="linenr">295: </span>      (<span style="color: #a020f0;">progn</span>
<span class="linenr">296: </span>        (setq fmt (get-time-format 'next))
<span class="linenr">297: </span>        (delete-region insert-time-start-point (point)))
<span class="linenr">298: </span>    (setq fmt (get-time-format 'current)))
<span class="linenr">299: </span>  (setq insert-time-start-point (point))
<span class="linenr">300: </span>  (insert (format-time-string fmt (current-time))))
<span class="linenr">301: </span>
<span class="linenr">302: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">insert-date</span> ()
<span class="linenr">303: </span>  (interactive)
<span class="linenr">304: </span>  (mapcar
<span class="linenr">305: </span>   (<span style="color: #a020f0;">lambda</span> (date)
<span class="linenr">306: </span>     (insert
<span class="linenr">307: </span>      (mhc-date-format date <span style="color: #8b2252;">"%04d&#24180;%02d&#26376;%02d&#26085;(%s)\n"</span> yy mm dd
<span class="linenr">308: </span>                       (mhc-date-digit-to-ww-japanese-string ww))))
<span class="linenr">309: </span>   (mhc-input-day <span style="color: #8b2252;">"Date list "</span> (mhc-date-now))))
<span class="linenr">310: </span>
<span class="linenr">311: </span>
<span class="linenr">312: </span><span style="color: #b22222;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">313: </span><span style="color: #b22222;">;; </span><span style="color: #b22222;">Suikou. Check  Katakana words.</span>
<span class="linenr">314: </span>
<span class="linenr">315: </span>(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">katakana-regexp</span>
<span class="linenr">316: </span>  (concat <span style="color: #8b2252;">"["</span>
<span class="linenr">317: </span>          <span style="color: #8b2252;">"&#12450;&#12452;&#12454;&#12456;&#12458;&#12449;&#12451;&#12453;&#12455;&#12457;&#12532;"</span>
<span class="linenr">318: </span>          <span style="color: #8b2252;">"&#12459;&#12461;&#12463;&#12465;&#12467;&#12460;&#12462;&#12464;&#12466;&#12468;"</span>
<span class="linenr">319: </span>          <span style="color: #8b2252;">"&#12469;&#12471;&#12473;&#12475;&#12477;&#12470;&#12472;&#12474;&#12476;&#12478;"</span>
<span class="linenr">320: </span>          <span style="color: #8b2252;">"&#12479;&#12481;&#12484;&#12486;&#12488;&#12480;&#12482;&#12485;&#12487;&#12489;&#12483;"</span>
<span class="linenr">321: </span>          <span style="color: #8b2252;">"&#12490;&#12491;&#12492;&#12493;&#12494;"</span>
<span class="linenr">322: </span>          <span style="color: #8b2252;">"&#12495;&#12498;&#12501;&#12504;&#12507;&#12496;&#12499;&#12502;&#12502;&#12505;&#12508;&#12497;&#12500;&#12503;&#12506;&#12509;"</span>
<span class="linenr">323: </span>          <span style="color: #8b2252;">"&#12510;&#12511;&#12512;&#12513;&#12514;"</span>
<span class="linenr">324: </span>          <span style="color: #8b2252;">"&#12516;&#12518;&#12520;&#12515;&#12517;&#12519;"</span>
<span class="linenr">325: </span>          <span style="color: #8b2252;">"&#12521;&#12522;&#12523;&#12524;&#12525;"</span>
<span class="linenr">326: </span>          <span style="color: #8b2252;">"&#12527;&#12530;&#12531;&#12540;&#12539;"</span>
<span class="linenr">327: </span>          <span style="color: #8b2252;">"]+"</span>))
<span class="linenr">328: </span>
<span class="linenr">329: </span>(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">katakana-buffer</span> <span style="color: #8b2252;">"*KATAKANA*"</span>)
<span class="linenr">330: </span>
<span class="linenr">331: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">katakana-check-workhorse</span> (target-buf result-buf erase sort)
<span class="linenr">332: </span>  (<span style="color: #a020f0;">let</span> ((str) (lin))
<span class="linenr">333: </span>    (<span style="color: #a020f0;">if</span> erase
<span class="linenr">334: </span>        (<span style="color: #a020f0;">save-excursion</span>
<span class="linenr">335: </span>          (set-buffer result-buf)
<span class="linenr">336: </span>          (erase-buffer)))
<span class="linenr">337: </span>    (<span style="color: #a020f0;">save-excursion</span>
<span class="linenr">338: </span>      (set-buffer target-buf)
<span class="linenr">339: </span>      (goto-char (point-min))
<span class="linenr">340: </span>      (<span style="color: #a020f0;">while</span> (re-search-forward katakana-regexp nil t)
<span class="linenr">341: </span>        (<span style="color: #a020f0;">save-match-data</span>
<span class="linenr">342: </span>          (setq str (match-string 0))
<span class="linenr">343: </span>          (setq lin (what-line))
<span class="linenr">344: </span>          (<span style="color: #a020f0;">save-excursion</span>
<span class="linenr">345: </span>            (set-buffer result-buf)
<span class="linenr">346: </span>            (insert str
<span class="linenr">347: </span>                    <span style="color: #8b2252;">"        "</span> (buffer-name target-buf)
<span class="linenr">348: </span>                    <span style="color: #8b2252;">"        "</span> lin <span style="color: #8b2252;">"\n"</span>)))))
<span class="linenr">349: </span>    (<span style="color: #a020f0;">if</span> sort
<span class="linenr">350: </span>        (<span style="color: #a020f0;">save-excursion</span>
<span class="linenr">351: </span>          (set-buffer result-buf)
<span class="linenr">352: </span>          (sort-lines nil (point-min) (point-max))))))
<span class="linenr">353: </span>
<span class="linenr">354: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">katakana-check</span> ()
<span class="linenr">355: </span>  (interactive)
<span class="linenr">356: </span>  (katakana-check-workhorse
<span class="linenr">357: </span>   (current-buffer)
<span class="linenr">358: </span>   (get-buffer-create katakana-buffer)
<span class="linenr">359: </span>   t t)
<span class="linenr">360: </span>  (switch-to-buffer-other-window katakana-buffer)
<span class="linenr">361: </span>  (goto-char (point-min)))
<span class="linenr">362: </span>
<span class="linenr">363: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">katakana-check-all</span> ()
<span class="linenr">364: </span>  (interactive)
<span class="linenr">365: </span>  (<span style="color: #a020f0;">let</span> ((result-buf (get-buffer-create katakana-buffer))
<span class="linenr">366: </span>        (buf-list (buffer-list))
<span class="linenr">367: </span>        (buf))
<span class="linenr">368: </span>    (<span style="color: #a020f0;">save-excursion</span>
<span class="linenr">369: </span>      (set-buffer result-buf)
<span class="linenr">370: </span>      (erase-buffer))
<span class="linenr">371: </span>    (<span style="color: #a020f0;">while</span> buf-list
<span class="linenr">372: </span>      (setq buf (car buf-list))
<span class="linenr">373: </span>      (<span style="color: #a020f0;">if</span> (string-match <span style="color: #8b2252;">"\\.tex$"</span> (buffer-name buf))
<span class="linenr">374: </span>          (katakana-check-workhorse buf result-buf nil t))
<span class="linenr">375: </span>      (setq buf-list (cdr buf-list)))
<span class="linenr">376: </span>    (switch-to-buffer-other-window result-buf)
<span class="linenr">377: </span>    (goto-char (point-min))))
<span class="linenr">378: </span>
<span class="linenr">379: </span><span style="color: #b22222;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">380: </span><span style="color: #b22222;">;; </span><span style="color: #b22222;">Check incorect chars for IPSJ papers.</span>
<span class="linenr">381: </span>
<span class="linenr">382: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ipsj-check</span> ()
<span class="linenr">383: </span>  (interactive)
<span class="linenr">384: </span>  (re-search-forward
<span class="linenr">385: </span>   (concat <span style="color: #8b2252;">"["</span>
<span class="linenr">386: </span>           <span style="color: #8b2252;">"&#12288;&#65281;&#8243;&#65283;&#65284;&#65285;&#65286;&#8242;"</span>
<span class="linenr">387: </span>           <span style="color: #8b2252;">"&#12288;&#12288;&#65290;&#65291;&#12289;&#65293;&#12290;&#65295;"</span>  <span style="color: #b22222;">; </span><span style="color: #b22222;">() &#12399;&#20840;&#35282; OK</span>
<span class="linenr">388: </span>           <span style="color: #8b2252;">"&#65296;&#65297;&#65298;&#65299;&#65300;&#65301;&#65302;&#65303;"</span>
<span class="linenr">389: </span>           <span style="color: #8b2252;">"&#65304;&#65305;&#65306;&#65307;&#65308;&#65309;&#65310;&#65311;"</span>  <span style="color: #b22222;">; </span><span style="color: #b22222;">&#65308;&#65310; &#12399;&#20840;&#35282; OK</span>
<span class="linenr">390: </span>           <span style="color: #8b2252;">"&#65312;&#65313;&#65314;&#65315;&#65316;&#65317;&#65318;&#65319;"</span>
<span class="linenr">391: </span>           <span style="color: #8b2252;">"&#65320;&#65321;&#65322;&#65323;&#65324;&#65325;&#65326;&#65327;"</span>
<span class="linenr">392: </span>           <span style="color: #8b2252;">"&#65328;&#65329;&#65330;&#65331;&#65332;&#65333;&#65334;&#65335;"</span>
<span class="linenr">393: </span>           <span style="color: #8b2252;">"&#65336;&#65337;&#65338;&#65339;&#65509;&#65341;&#65342;&#65343;"</span>
<span class="linenr">394: </span>           <span style="color: #8b2252;">"&#8216;&#65345;&#65346;&#65347;&#65348;&#65349;&#65350;&#65351;"</span>
<span class="linenr">395: </span>           <span style="color: #8b2252;">"&#65352;&#65353;&#65354;&#65355;&#65356;&#65357;&#65358;&#65359;"</span>
<span class="linenr">396: </span>           <span style="color: #8b2252;">"&#65360;&#65361;&#65362;&#65363;&#65364;&#65365;&#65366;&#65367;"</span>
<span class="linenr">397: </span>           <span style="color: #8b2252;">"&#65368;&#65369;&#65370;&#65371;&#65372;&#65373;&#12316;"</span>
<span class="linenr">398: </span>          <span style="color: #b22222;">; </span><span style="color: #b22222;">"&lt;&gt;%()"</span>
<span class="linenr">399: </span>           <span style="color: #8b2252;">"]+"</span>
<span class="linenr">400: </span>           )
<span class="linenr">401: </span>   nil t))
<span class="linenr">402: </span>
<span class="linenr">403: </span>
<span class="linenr">404: </span><span style="color: #b22222;">;; </span><span style="color: #b22222;">replace references</span>
<span class="linenr">405: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ipsj-replace-ref</span> (ref-regex ref-heading)
<span class="linenr">406: </span>  (<span style="color: #a020f0;">let</span> (to-str)
<span class="linenr">407: </span>    (<span style="color: #a020f0;">while</span> (re-search-forward ref-regex nil t)
<span class="linenr">408: </span>      (<span style="color: #a020f0;">save-match-data</span>
<span class="linenr">409: </span>        (setq to-str (concat ref-heading
<span class="linenr">410: </span>                             (japanese-hankaku (match-string 1) t)
<span class="linenr">411: </span>                             <span style="color: #8b2252;">"}"</span>)))
<span class="linenr">412: </span>      (<span style="color: #a020f0;">if</span> (y-or-n-p (format <span style="color: #8b2252;">"replace %s to %s ?"</span> (match-string 0) to-str))
<span class="linenr">413: </span>          (replace-match to-str nil t)))))
<span class="linenr">414: </span>
<span class="linenr">415: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ipsj-replace-figref</span> ()
<span class="linenr">416: </span>  (interactive)
<span class="linenr">417: </span>  (ipsj-replace-ref <span style="color: #8b2252;">"&#22259;</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">(</span><span style="color: #8b2252;">[&#65296;-&#65305;]+</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">)</span><span style="color: #8b2252;">"</span> <span style="color: #8b2252;">"\\figuref{fig:fig"</span>))
<span class="linenr">418: </span>
<span class="linenr">419: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ipsj-replace-tabref</span> ()
<span class="linenr">420: </span>  (interactive)
<span class="linenr">421: </span>  (ipsj-replace-ref <span style="color: #8b2252;">"&#34920;</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">(</span><span style="color: #8b2252;">[&#65296;-&#65305;]+</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">)</span><span style="color: #8b2252;">"</span> <span style="color: #8b2252;">"\\tabref{tab:tab"</span>))
<span class="linenr">422: </span>
<span class="linenr">423: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ipsj-replace-bibref</span> ()
<span class="linenr">424: </span>  (interactive)
<span class="linenr">425: </span>  (ipsj-replace-ref <span style="color: #8b2252;">"[\[&#65339;]</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">(</span><span style="color: #8b2252;">[&#65296;-&#65305;0-9]+</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">)</span><span style="color: #8b2252;">[\]&#65341;]"</span> <span style="color: #8b2252;">"\\cite{bib:bib"</span>))
<span class="linenr">426: </span>
<span class="linenr">427: </span><span style="color: #b22222;">;; </span><span style="color: #b22222;">replace comma and dots.</span>
<span class="linenr">428: </span><span style="color: #b22222;">;; </span><span style="color: #b22222;">(defun ipsj-replace-char ()</span>
<span class="linenr">429: </span><span style="color: #b22222;">;;   </span><span style="color: #b22222;">(interactive)</span>
<span class="linenr">430: </span><span style="color: #b22222;">;;   </span><span style="color: #b22222;">(goto-char (point-min))</span>
<span class="linenr">431: </span><span style="color: #b22222;">;;   </span><span style="color: #b22222;">(replace-string "&#12289;" "&#65292;")</span>
<span class="linenr">432: </span><span style="color: #b22222;">;;   </span><span style="color: #b22222;">(goto-char (point-min))</span>
<span class="linenr">433: </span><span style="color: #b22222;">;;   </span><span style="color: #b22222;">(replace-string "&#12290;" "&#65294;"))</span>
<span class="linenr">434: </span>
<span class="linenr">435: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ipsj-japanese-hankaku-region</span> (from to <span style="color: #228b22;">&amp;optional</span> all)
<span class="linenr">436: </span>  (interactive <span style="color: #8b2252;">"r\nP"</span>)
<span class="linenr">437: </span>  (japanese-zenkaku-region from to t) <span style="color: #b22222;">;; </span><span style="color: #b22222;">Katakana only</span>
<span class="linenr">438: </span>  (japanese-hankaku-region from to t) <span style="color: #b22222;">;; </span><span style="color: #b22222;">ASCII only</span>
<span class="linenr">439: </span>  )
<span class="linenr">440: </span>
<span class="linenr">441: </span><span style="color: #b22222;">;;   </span><span style="color: #b22222;">\\cK &#12459;&#12479;&#12459;&#12490;</span>
<span class="linenr">442: </span><span style="color: #b22222;">;;   </span><span style="color: #b22222;">\\cC &#28450;&#23383;</span>
<span class="linenr">443: </span><span style="color: #b22222;">;;   </span><span style="color: #b22222;">\\cH &#12402;&#12425;&#12364;&#12394;</span>
<span class="linenr">444: </span><span style="color: #b22222;">;;   </span><span style="color: #b22222;">\\cS &#20840;&#35282;&#35352;&#21495;</span>
<span class="linenr">445: </span><span style="color: #b22222;">;;   </span><span style="color: #b22222;">\\cj &#26085;&#26412;&#35486; (&#19978;&#35352;&#20840;&#37096;)</span>
<span class="linenr">446: </span><span style="color: #b22222;">;;   </span><span style="color: #b22222;">\\ck &#21322;&#35282;&#12459;&#12490;</span>
<span class="linenr">447: </span><span style="color: #b22222;">;;   </span><span style="color: #b22222;">\\ca ASCII</span>
<span class="linenr">448: </span>
<span class="linenr">449: </span>
<span class="linenr">450: </span>  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">32 sp    33  !    34  "    35  #    36  $    37  %    38  &amp;    39  '</span>
<span class="linenr">451: </span>  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">40  (    41  )    42  *    43  +    44  ,    45  -    46  .    47  /</span>
<span class="linenr">452: </span>  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">48  0    49  1    50  2    51  3    52  4    53  5    54  6    55  7</span>
<span class="linenr">453: </span>  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">56  8    57  9    58  :    59  ;    60  &lt;    61  =    62  &gt;    63  ?</span>
<span class="linenr">454: </span>  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">64  @    65  A    66  B    67  C    68  D    69  E    70  F    71  G</span>
<span class="linenr">455: </span>  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">72  H    73  I    74  J    75  K    76  L    77  M    78  N    79  O</span>
<span class="linenr">456: </span>  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">80  P    81  Q    82  R    83  S    84  T    85  U    86  V    87  W</span>
<span class="linenr">457: </span>  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">88  X    89  Y    90  Z    91  [    92  \    93  ]    94  ^    95  _</span>
<span class="linenr">458: </span>  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">96  `    97  a    98  b    99  c   100  d   101  e   102  f   103  g</span>
<span class="linenr">459: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">104  h   105  i   106  j   107  k   108  l   109  m   110  n   111  o</span>
<span class="linenr">460: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">112  p   113  q   114  r   115  s   116  t   117  u   118  v   119  w</span>
<span class="linenr">461: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">120  x   121  y   122  z   123  {   124  |   125  }   126  ~   127 del</span>
<span class="linenr">462: </span>
<span class="linenr">463: </span>
<span class="linenr">464: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">1) ASCII &#12395;&#12354;&#12427;&#25991;&#23383;&#12399;&#65292;&#21322;&#35282;&#12395;&#32622;&#12365;&#25563;&#12360;&#12427;</span>
<span class="linenr">465: </span>  <span style="color: #b22222;">;;    </span><span style="color: #b22222;">&#12383;&#12384;&#12375;&#65292;&#20197;&#19979;&#12398;&#25991;&#23383;&#12399;&#65292;&#22793;&#25563;&#12375;&#12394;&#12356;</span>
<span class="linenr">466: </span>  <span style="color: #b22222;">;;    </span><span style="color: #b22222;">&#12289;&#8722;&#12290;&#12316;&#65292;&#65294;</span>
<span class="linenr">467: </span>  <span style="color: #b22222;">;;</span>
<span class="linenr">468: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">2) &#20840;&#35282;&#12473;&#12506;&#12540;&#12473;&#12399;&#65292;&#21322;&#35282;&#12473;&#12506;&#12540;&#12473; x 2 &#12395;&#32622;&#12365;&#25563;&#12360;&#12427;</span>
<span class="linenr">469: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">3) &#12289;&#8722;&#12290;&#12316;&#65292;&#65294; &#12399;&#65292;&#20197;&#19979;&#12398;&#12523;&#12540;&#12523;&#12391;&#22793;&#25563;&#12377;&#12427;</span>
<span class="linenr">470: </span>  <span style="color: #b22222;">;;    </span><span style="color: #b22222;">1) &#30452;&#21069;&#12364;&#20840;&#35282;&#12394;&#12425;&#12400;&#65292;&#12381;&#12398;&#12414;&#12414;</span>
<span class="linenr">471: </span>
<span class="linenr">472: </span>  <span style="color: #b22222;">;;    </span><span style="color: #b22222;">! " # $ % &amp; '</span>
<span class="linenr">473: </span>  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">( ) * + , - . /</span>
<span class="linenr">474: </span>  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">0 1 2 3 4 5 6 7</span>
<span class="linenr">475: </span>  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">8 9 : ; &lt; = &gt; ?</span>
<span class="linenr">476: </span>  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">@ A B C D E F G</span>
<span class="linenr">477: </span>  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">H I J K L M N O</span>
<span class="linenr">478: </span>  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">P Q R S T U V W</span>
<span class="linenr">479: </span>  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">X Y Z [ \ ] ^ _</span>
<span class="linenr">480: </span>  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">` a b c d e f g</span>
<span class="linenr">481: </span>  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">h i j k l m n o</span>
<span class="linenr">482: </span>  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">p q r s t u v w</span>
<span class="linenr">483: </span>  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">x y z { | } ~</span>
<span class="linenr">484: </span>
<span class="linenr">485: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12288; &#65281; &#8243; &#65283; &#65284; &#65285; &#65286; &#8242;</span>
<span class="linenr">486: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#65288; &#65289; &#65290; &#65291; &#12289; &#8722; &#12290; &#65295;</span>
<span class="linenr">487: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#65296; &#65297; &#65298; &#65299; &#65300; &#65301; &#65302; &#65303;</span>
<span class="linenr">488: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#65304; &#65305; &#65306; &#65307; &#65308; &#65309; &#65310; &#65311;</span>
<span class="linenr">489: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#65312; &#65313; &#65314; &#65315; &#65316; &#65317; &#65318; &#65319;</span>
<span class="linenr">490: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#65320; &#65321; &#65322; &#65323; &#65324; &#65325; &#65326; &#65327;</span>
<span class="linenr">491: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#65328; &#65329; &#65330; &#65331; &#65332; &#65333; &#65334; &#65335;</span>
<span class="linenr">492: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#65336; &#65337; &#65338; &#65339; &#65509; &#65341; &#65342; &#65343;</span>
<span class="linenr">493: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#8216; &#65345; &#65346; &#65347; &#65348; &#65349; &#65350; &#65351;</span>
<span class="linenr">494: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#65352; &#65353; &#65354; &#65355; &#65356; &#65357; &#65358; &#65359;</span>
<span class="linenr">495: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#65360; &#65361; &#65362; &#65363; &#65364; &#65365; &#65366; &#65367;</span>
<span class="linenr">496: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#65368; &#65369; &#65370; &#65371; &#65372; &#65373; &#12316;</span>
<span class="linenr">497: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#65292;&#65294;&#8217;&#8221;&#12539;</span>
<span class="linenr">498: </span>
<span class="linenr">499: </span>(setq zenkaku-to-hankaku-table
<span class="linenr">500: </span>  '((<span style="color: #8b2252;">"&#12288;"</span> . <span style="color: #8b2252;">"  "</span>)
<span class="linenr">501: </span>    (<span style="color: #8b2252;">"&#65281;"</span> . <span style="color: #8b2252;">"!"</span>)
<span class="linenr">502: </span>    (<span style="color: #8b2252;">"&#8243;"</span> . <span style="color: #8b2252;">"\""</span>) (<span style="color: #8b2252;">"&#8221;"</span> . <span style="color: #8b2252;">"\""</span>)
<span class="linenr">503: </span>    (<span style="color: #8b2252;">"&#65283;"</span> . <span style="color: #8b2252;">"#"</span>)
<span class="linenr">504: </span>    (<span style="color: #8b2252;">"&#65284;"</span> . <span style="color: #8b2252;">"$"</span>)
<span class="linenr">505: </span>    (<span style="color: #8b2252;">"&#65285;"</span> . <span style="color: #8b2252;">"%"</span>)
<span class="linenr">506: </span>    (<span style="color: #8b2252;">"&#65286;"</span> . <span style="color: #8b2252;">"&amp;"</span>)
<span class="linenr">507: </span>    (<span style="color: #8b2252;">"&#8242;"</span> . <span style="color: #8b2252;">"'"</span>) (<span style="color: #8b2252;">"&#8217;"</span> . <span style="color: #8b2252;">"'"</span>)
<span class="linenr">508: </span>    (<span style="color: #8b2252;">"&#65288;"</span> . <span style="color: #8b2252;">"("</span>)
<span class="linenr">509: </span>    (<span style="color: #8b2252;">"&#65289;"</span> . <span style="color: #8b2252;">")"</span>)
<span class="linenr">510: </span>    (<span style="color: #8b2252;">"&#65290;"</span> . <span style="color: #8b2252;">"*"</span>)
<span class="linenr">511: </span>    (<span style="color: #8b2252;">"&#65291;"</span> . <span style="color: #8b2252;">"+"</span>)
<span class="linenr">512: </span>    (<span style="color: #8b2252;">"&#12289;"</span> . <span style="color: #8b2252;">"&#65292;"</span>) <span style="color: #b22222;">;; </span><span style="color: #b22222;">("&#65292;" . ",")</span>
<span class="linenr">513: </span>    (<span style="color: #8b2252;">"&#8722;"</span> . <span style="color: #8b2252;">"-"</span>)  <span style="color: #b22222;">;; </span><span style="color: #b22222;">("&#12540;" . "-")</span>
<span class="linenr">514: </span>    (<span style="color: #8b2252;">"&#12290;"</span> . <span style="color: #8b2252;">"&#65294;"</span>) <span style="color: #b22222;">;; </span><span style="color: #b22222;">("&#65294;" . ".")</span>
<span class="linenr">515: </span>    (<span style="color: #8b2252;">"&#65295;"</span> . <span style="color: #8b2252;">"/"</span>)
<span class="linenr">516: </span>    (<span style="color: #8b2252;">"&#65296;"</span> . <span style="color: #8b2252;">"0"</span>)
<span class="linenr">517: </span>    (<span style="color: #8b2252;">"&#65297;"</span> . <span style="color: #8b2252;">"1"</span>)
<span class="linenr">518: </span>    (<span style="color: #8b2252;">"&#65298;"</span> . <span style="color: #8b2252;">"2"</span>)
<span class="linenr">519: </span>    (<span style="color: #8b2252;">"&#65299;"</span> . <span style="color: #8b2252;">"3"</span>)
<span class="linenr">520: </span>    (<span style="color: #8b2252;">"&#65300;"</span> . <span style="color: #8b2252;">"4"</span>)
<span class="linenr">521: </span>    (<span style="color: #8b2252;">"&#65301;"</span> . <span style="color: #8b2252;">"5"</span>)
<span class="linenr">522: </span>    (<span style="color: #8b2252;">"&#65302;"</span> . <span style="color: #8b2252;">"6"</span>)
<span class="linenr">523: </span>    (<span style="color: #8b2252;">"&#65303;"</span> . <span style="color: #8b2252;">"7"</span>)
<span class="linenr">524: </span>    (<span style="color: #8b2252;">"&#65304;"</span> . <span style="color: #8b2252;">"8"</span>)
<span class="linenr">525: </span>    (<span style="color: #8b2252;">"&#65305;"</span> . <span style="color: #8b2252;">"9"</span>)
<span class="linenr">526: </span>    (<span style="color: #8b2252;">"&#65306;"</span> . <span style="color: #8b2252;">":"</span>)
<span class="linenr">527: </span>    (<span style="color: #8b2252;">"&#65307;"</span> . <span style="color: #8b2252;">";"</span>)
<span class="linenr">528: </span>    (<span style="color: #8b2252;">"&#65308;"</span> . <span style="color: #8b2252;">"&lt;"</span>)
<span class="linenr">529: </span>    (<span style="color: #8b2252;">"&#65309;"</span> . <span style="color: #8b2252;">"="</span>)
<span class="linenr">530: </span>    (<span style="color: #8b2252;">"&#65310;"</span> . <span style="color: #8b2252;">"&gt;"</span>)
<span class="linenr">531: </span>    (<span style="color: #8b2252;">"&#65311;"</span> . <span style="color: #8b2252;">"?"</span>)
<span class="linenr">532: </span>    (<span style="color: #8b2252;">"&#65312;"</span> . <span style="color: #8b2252;">"@"</span>)
<span class="linenr">533: </span>    (<span style="color: #8b2252;">"&#65313;"</span> . <span style="color: #8b2252;">"A"</span>)
<span class="linenr">534: </span>    (<span style="color: #8b2252;">"&#65314;"</span> . <span style="color: #8b2252;">"B"</span>)
<span class="linenr">535: </span>    (<span style="color: #8b2252;">"&#65315;"</span> . <span style="color: #8b2252;">"C"</span>)
<span class="linenr">536: </span>    (<span style="color: #8b2252;">"&#65316;"</span> . <span style="color: #8b2252;">"D"</span>)
<span class="linenr">537: </span>    (<span style="color: #8b2252;">"&#65317;"</span> . <span style="color: #8b2252;">"E"</span>)
<span class="linenr">538: </span>    (<span style="color: #8b2252;">"&#65318;"</span> . <span style="color: #8b2252;">"F"</span>)
<span class="linenr">539: </span>    (<span style="color: #8b2252;">"&#65319;"</span> . <span style="color: #8b2252;">"G"</span>)
<span class="linenr">540: </span>    (<span style="color: #8b2252;">"&#65320;"</span> . <span style="color: #8b2252;">"H"</span>)
<span class="linenr">541: </span>    (<span style="color: #8b2252;">"&#65321;"</span> . <span style="color: #8b2252;">"I"</span>)
<span class="linenr">542: </span>    (<span style="color: #8b2252;">"&#65322;"</span> . <span style="color: #8b2252;">"J"</span>)
<span class="linenr">543: </span>    (<span style="color: #8b2252;">"&#65323;"</span> . <span style="color: #8b2252;">"K"</span>)
<span class="linenr">544: </span>    (<span style="color: #8b2252;">"&#65324;"</span> . <span style="color: #8b2252;">"L"</span>)
<span class="linenr">545: </span>    (<span style="color: #8b2252;">"&#65325;"</span> . <span style="color: #8b2252;">"M"</span>)
<span class="linenr">546: </span>    (<span style="color: #8b2252;">"&#65326;"</span> . <span style="color: #8b2252;">"N"</span>)
<span class="linenr">547: </span>    (<span style="color: #8b2252;">"&#65327;"</span> . <span style="color: #8b2252;">"O"</span>)
<span class="linenr">548: </span>    (<span style="color: #8b2252;">"&#65328;"</span> . <span style="color: #8b2252;">"P"</span>)
<span class="linenr">549: </span>    (<span style="color: #8b2252;">"&#65329;"</span> . <span style="color: #8b2252;">"Q"</span>)
<span class="linenr">550: </span>    (<span style="color: #8b2252;">"&#65330;"</span> . <span style="color: #8b2252;">"R"</span>)
<span class="linenr">551: </span>    (<span style="color: #8b2252;">"&#65331;"</span> . <span style="color: #8b2252;">"S"</span>)
<span class="linenr">552: </span>    (<span style="color: #8b2252;">"&#65332;"</span> . <span style="color: #8b2252;">"T"</span>)
<span class="linenr">553: </span>    (<span style="color: #8b2252;">"&#65333;"</span> . <span style="color: #8b2252;">"U"</span>)
<span class="linenr">554: </span>    (<span style="color: #8b2252;">"&#65334;"</span> . <span style="color: #8b2252;">"V"</span>)
<span class="linenr">555: </span>    (<span style="color: #8b2252;">"&#65335;"</span> . <span style="color: #8b2252;">"W"</span>)
<span class="linenr">556: </span>    (<span style="color: #8b2252;">"&#65336;"</span> . <span style="color: #8b2252;">"X"</span>)
<span class="linenr">557: </span>    (<span style="color: #8b2252;">"&#65337;"</span> . <span style="color: #8b2252;">"Y"</span>)
<span class="linenr">558: </span>    (<span style="color: #8b2252;">"&#65338;"</span> . <span style="color: #8b2252;">"Z"</span>)
<span class="linenr">559: </span>    (<span style="color: #8b2252;">"&#65339;"</span> . <span style="color: #8b2252;">"["</span>)
<span class="linenr">560: </span>    (<span style="color: #8b2252;">"&#65509;"</span> . <span style="color: #8b2252;">"\\"</span>) (<span style="color: #8b2252;">"&#65340;"</span> . <span style="color: #8b2252;">"\\"</span>)
<span class="linenr">561: </span>    (<span style="color: #8b2252;">"&#65341;"</span> . <span style="color: #8b2252;">"]"</span>)
<span class="linenr">562: </span>    (<span style="color: #8b2252;">"&#65342;"</span> . <span style="color: #8b2252;">"^"</span>)
<span class="linenr">563: </span>    (<span style="color: #8b2252;">"&#65343;"</span> . <span style="color: #8b2252;">"_"</span>)
<span class="linenr">564: </span>    (<span style="color: #8b2252;">"&#8216;"</span> . <span style="color: #8b2252;">"`"</span>)
<span class="linenr">565: </span>    (<span style="color: #8b2252;">"&#65345;"</span> . <span style="color: #8b2252;">"a"</span>)
<span class="linenr">566: </span>    (<span style="color: #8b2252;">"&#65346;"</span> . <span style="color: #8b2252;">"b"</span>)
<span class="linenr">567: </span>    (<span style="color: #8b2252;">"&#65347;"</span> . <span style="color: #8b2252;">"c"</span>)
<span class="linenr">568: </span>    (<span style="color: #8b2252;">"&#65348;"</span> . <span style="color: #8b2252;">"d"</span>)
<span class="linenr">569: </span>    (<span style="color: #8b2252;">"&#65349;"</span> . <span style="color: #8b2252;">"e"</span>)
<span class="linenr">570: </span>    (<span style="color: #8b2252;">"&#65350;"</span> . <span style="color: #8b2252;">"f"</span>)
<span class="linenr">571: </span>    (<span style="color: #8b2252;">"&#65351;"</span> . <span style="color: #8b2252;">"g"</span>)
<span class="linenr">572: </span>    (<span style="color: #8b2252;">"&#65352;"</span> . <span style="color: #8b2252;">"h"</span>)
<span class="linenr">573: </span>    (<span style="color: #8b2252;">"&#65353;"</span> . <span style="color: #8b2252;">"i"</span>)
<span class="linenr">574: </span>    (<span style="color: #8b2252;">"&#65354;"</span> . <span style="color: #8b2252;">"j"</span>)
<span class="linenr">575: </span>    (<span style="color: #8b2252;">"&#65355;"</span> . <span style="color: #8b2252;">"k"</span>)
<span class="linenr">576: </span>    (<span style="color: #8b2252;">"&#65356;"</span> . <span style="color: #8b2252;">"l"</span>)
<span class="linenr">577: </span>    (<span style="color: #8b2252;">"&#65357;"</span> . <span style="color: #8b2252;">"m"</span>)
<span class="linenr">578: </span>    (<span style="color: #8b2252;">"&#65358;"</span> . <span style="color: #8b2252;">"n"</span>)
<span class="linenr">579: </span>    (<span style="color: #8b2252;">"&#65359;"</span> . <span style="color: #8b2252;">"o"</span>)
<span class="linenr">580: </span>    (<span style="color: #8b2252;">"&#65360;"</span> . <span style="color: #8b2252;">"p"</span>)
<span class="linenr">581: </span>    (<span style="color: #8b2252;">"&#65361;"</span> . <span style="color: #8b2252;">"q"</span>)
<span class="linenr">582: </span>    (<span style="color: #8b2252;">"&#65362;"</span> . <span style="color: #8b2252;">"r"</span>)
<span class="linenr">583: </span>    (<span style="color: #8b2252;">"&#65363;"</span> . <span style="color: #8b2252;">"s"</span>)
<span class="linenr">584: </span>    (<span style="color: #8b2252;">"&#65364;"</span> . <span style="color: #8b2252;">"t"</span>)
<span class="linenr">585: </span>    (<span style="color: #8b2252;">"&#65365;"</span> . <span style="color: #8b2252;">"u"</span>)
<span class="linenr">586: </span>    (<span style="color: #8b2252;">"&#65366;"</span> . <span style="color: #8b2252;">"v"</span>)
<span class="linenr">587: </span>    (<span style="color: #8b2252;">"&#65367;"</span> . <span style="color: #8b2252;">"w"</span>)
<span class="linenr">588: </span>    (<span style="color: #8b2252;">"&#65368;"</span> . <span style="color: #8b2252;">"x"</span>)
<span class="linenr">589: </span>    (<span style="color: #8b2252;">"&#65369;"</span> . <span style="color: #8b2252;">"y"</span>)
<span class="linenr">590: </span>    (<span style="color: #8b2252;">"&#65370;"</span> . <span style="color: #8b2252;">"z"</span>)
<span class="linenr">591: </span>    (<span style="color: #8b2252;">"&#65371;"</span> . <span style="color: #8b2252;">"{"</span>)
<span class="linenr">592: </span>    (<span style="color: #8b2252;">"&#65372;"</span> . <span style="color: #8b2252;">"|"</span>)
<span class="linenr">593: </span>    (<span style="color: #8b2252;">"&#65373;"</span> . <span style="color: #8b2252;">"}"</span>)
<span class="linenr">594: </span>    (<span style="color: #8b2252;">"&#12316;"</span> . <span style="color: #8b2252;">"~"</span>)
<span class="linenr">595: </span>    (<span style="color: #8b2252;">"&#65374;"</span> . <span style="color: #8b2252;">"-"</span>)
<span class="linenr">596: </span>    <span style="color: #b22222;">;; </span><span style="color: #b22222;">("&#12539;" . ".")</span>
<span class="linenr">597: </span>    ))
<span class="linenr">598: </span>
<span class="linenr">599: </span>(setq zenkaku-regexp
<span class="linenr">600: </span>  (concat <span style="color: #8b2252;">"["</span> (mapconcat (<span style="color: #a020f0;">lambda</span> (z) (car z)) zenkaku-to-hankaku-table nil) <span style="color: #8b2252;">"]"</span>))
<span class="linenr">601: </span>
<span class="linenr">602: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">replace-zenkaku-to-hankaku</span> (from to <span style="color: #228b22;">&amp;optional</span> all)
<span class="linenr">603: </span>  (interactive <span style="color: #8b2252;">"r\nP"</span>)
<span class="linenr">604: </span>  (<span style="color: #a020f0;">let</span> ((match) (replacement)
<span class="linenr">605: </span>        (mark (make-overlay from from))
<span class="linenr">606: </span>        (anno))
<span class="linenr">607: </span>    (overlay-put mark 'priority 1001)
<span class="linenr">608: </span>    (overlay-put mark 'face 'query-replace)
<span class="linenr">609: </span>    (goto-char from)
<span class="linenr">610: </span>    (<span style="color: #a020f0;">while</span> (re-search-forward zenkaku-regexp nil t)
<span class="linenr">611: </span>      (setq match (char-to-string (preceding-char))
<span class="linenr">612: </span>            replacement (cdr (assoc match zenkaku-to-hankaku-table)))
<span class="linenr">613: </span>      (move-overlay mark (match-beginning 0) (match-end 0))
<span class="linenr">614: </span>      (<span style="color: #a020f0;">when</span> (and replacement)
<span class="linenr">615: </span>        <span style="color: #b22222;">;; </span><span style="color: #b22222;">(or all (y-or-n-p (format "Replace [%s] to [%s]?" match replacement))))</span>
<span class="linenr">616: </span>        (replace-match replacement)
<span class="linenr">617: </span>        (setq anno (make-overlay (- (point) (length replacement)) (point)))
<span class="linenr">618: </span>        (overlay-put anno 'face 'highlight)))
<span class="linenr">619: </span>        <span style="color: #b22222;">;; </span><span style="color: #b22222;">(put-text-property (1- (point)) (point) 'face 'highlight)))</span>
<span class="linenr">620: </span>    (delete-overlay mark)))
<span class="linenr">621: </span>
<span class="linenr">622: </span>
<span class="linenr">623: </span>  <span style="color: #b22222;">;;   </span><span style="color: #b22222;">! " # $ % &amp; '</span>
<span class="linenr">624: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">( ) * + , - . /</span>
<span class="linenr">625: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">0 1 2 3 4 5 6 7</span>
<span class="linenr">626: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">8 9 : ; &lt; = &gt; ?</span>
<span class="linenr">627: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">@ A B C D E F G</span>
<span class="linenr">628: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">H I J K L M N O</span>
<span class="linenr">629: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">P Q R S T U V W</span>
<span class="linenr">630: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">X Y Z [ \ ] ^ _</span>
<span class="linenr">631: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">` a b c d e f g</span>
<span class="linenr">632: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">h i j k l m n o</span>
<span class="linenr">633: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">p q r s t u v w</span>
<span class="linenr">634: </span>  <span style="color: #b22222;">;; </span><span style="color: #b22222;">x y z { | } ~</span>
<span class="linenr">635: </span>
<span class="linenr">636: </span>
<span class="linenr">637: </span>  <span style="color: #8b2252;">"!\"#$%&amp;'"</span>
<span class="linenr">638: </span>  <span style="color: #8b2252;">"  *+&#65380;-&#65377;/"</span>
<span class="linenr">639: </span>  <span style="color: #8b2252;">"01234567"</span>
<span class="linenr">640: </span>  <span style="color: #8b2252;">"89:;&lt;=&gt;?"</span>
<span class="linenr">641: </span>  <span style="color: #8b2252;">"@ABCDEFG"</span>
<span class="linenr">642: </span>  <span style="color: #8b2252;">"HIJKLMNO"</span>
<span class="linenr">643: </span>  <span style="color: #8b2252;">"PQRSTUVW"</span>
<span class="linenr">644: </span>  <span style="color: #8b2252;">"XYZ[\]^_"</span>
<span class="linenr">645: </span>  <span style="color: #8b2252;">"`abcdefg"</span>
<span class="linenr">646: </span>  <span style="color: #8b2252;">"hijklmno"</span>
<span class="linenr">647: </span>  <span style="color: #8b2252;">"pqrstuvw"</span>
<span class="linenr">648: </span>  <span style="color: #8b2252;">"xyz{|}~"</span>
<span class="linenr">649: </span>
<span class="linenr">650: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ipsj-replace-char</span> (p1 p2 <span style="color: #228b22;">&amp;optional</span> reverse)
<span class="linenr">651: </span>  (interactive <span style="color: #8b2252;">"r\nP"</span>)
<span class="linenr">652: </span>  (<span style="color: #a020f0;">if</span> reverse
<span class="linenr">653: </span>      (<span style="color: #a020f0;">save-excursion</span>
<span class="linenr">654: </span>        (replace-string <span style="color: #8b2252;">"&#65292;"</span> <span style="color: #8b2252;">"&#12289;"</span> nil p1 p2)
<span class="linenr">655: </span>        (replace-string <span style="color: #8b2252;">"&#65294;"</span> <span style="color: #8b2252;">"&#12290;"</span> nil p1 p2))
<span class="linenr">656: </span>    (<span style="color: #a020f0;">save-excursion</span>
<span class="linenr">657: </span>      (replace-string <span style="color: #8b2252;">"&#12289;"</span> <span style="color: #8b2252;">"&#65292;"</span> nil p1 p2)
<span class="linenr">658: </span>      (replace-string <span style="color: #8b2252;">"&#12290;"</span> <span style="color: #8b2252;">"&#65294;"</span> nil p1 p2))
<span class="linenr">659: </span>    ))
<span class="linenr">660: </span>
<span class="linenr">661: </span><span style="color: #b22222;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">662: </span><span style="color: #b22222;">;;; </span><span style="color: #b22222;">make index for TeX using kakasi.</span>
<span class="linenr">663: </span>
<span class="linenr">664: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">kakasi-region</span> (p1 p2)
<span class="linenr">665: </span>  (interactive <span style="color: #8b2252;">"r"</span>)
<span class="linenr">666: </span>  (<span style="color: #a020f0;">let</span> ((word (buffer-substring p1 p2))
<span class="linenr">667: </span>        (yomi ())
<span class="linenr">668: </span>        (kbuf (get-buffer-create <span style="color: #8b2252;">" *TMP-KAKASI*"</span>)))
<span class="linenr">669: </span>    (<span style="color: #a020f0;">save-excursion</span>
<span class="linenr">670: </span>      (set-buffer kbuf)
<span class="linenr">671: </span>      (erase-buffer))
<span class="linenr">672: </span>    (call-process-region p1 p2 <span style="color: #8b2252;">"kakasi"</span> nil kbuf nil <span style="color: #8b2252;">"-JH"</span> <span style="color: #8b2252;">"-KH"</span>)
<span class="linenr">673: </span>    (<span style="color: #a020f0;">save-excursion</span>
<span class="linenr">674: </span>      (set-buffer kbuf)
<span class="linenr">675: </span>      (setq yomi (buffer-substring (point-min) (point-max))))
<span class="linenr">676: </span>    (<span style="color: #a020f0;">if</span> (interactive-p)
<span class="linenr">677: </span>        (message yomi)
<span class="linenr">678: </span>      yomi)))
<span class="linenr">679: </span>
<span class="linenr">680: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">index-region</span> (p1 p2)
<span class="linenr">681: </span>  (interactive <span style="color: #8b2252;">"r"</span>)
<span class="linenr">682: </span>  (<span style="color: #a020f0;">let</span> ((word (buffer-substring p1 p2))
<span class="linenr">683: </span>        (yomi (kakasi-region    p1 p2)))
<span class="linenr">684: </span>    (<span style="color: #a020f0;">if</span> (string= word yomi)
<span class="linenr">685: </span>        (insert (format <span style="color: #8b2252;">"\\index{%s}"</span> word))
<span class="linenr">686: </span>      (insert (format <span style="color: #8b2252;">"\\index{%s@%s}"</span> yomi word)))))
<span class="linenr">687: </span>
<span class="linenr">688: </span><span style="color: #b22222;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">689: </span><span style="color: #b22222;">;;; </span><span style="color: #b22222;">misc.</span>
<span class="linenr">690: </span>
<span class="linenr">691: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-kanji-char-after</span> (point)
<span class="linenr">692: </span>  (<span style="color: #a020f0;">save-excursion</span>
<span class="linenr">693: </span>    (goto-char (point))
<span class="linenr">694: </span>    (<span style="color: #a020f0;">if</span> (looking-at <span style="color: #8b2252;">"."</span>)
<span class="linenr">695: </span>        (buffer-substring (match-beginning 0) (match-end 0))
<span class="linenr">696: </span>      (<span style="color: #a020f0;">if</span> (looking-at <span style="color: #8b2252;">"\n"</span>)
<span class="linenr">697: </span>          <span style="color: #8b2252;">"\n"</span>))))
<span class="linenr">698: </span>
<span class="linenr">699: </span>(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">char-stack</span> (list () ))
<span class="linenr">700: </span>(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">func-stack</span> (list () ))
<span class="linenr">701: </span>
<span class="linenr">702: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-delete-char</span> ()
<span class="linenr">703: </span>  (interactive)
<span class="linenr">704: </span>  (push-char (my-kanji-char-after (point)) <span style="color: #8b2252;">"delete-char"</span>)
<span class="linenr">705: </span>  (delete-char 1)
<span class="linenr">706: </span>  )
<span class="linenr">707: </span>
<span class="linenr">708: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-backward-delete-char-untabify</span> ()
<span class="linenr">709: </span>  (interactive)
<span class="linenr">710: </span>  (backward-char 1)
<span class="linenr">711: </span>  (push-char (my-kanji-char-after (point)) <span style="color: #8b2252;">"backward-delete-char-untabify"</span>)
<span class="linenr">712: </span>  (delete-char 1)
<span class="linenr">713: </span>  )
<span class="linenr">714: </span>
<span class="linenr">715: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">push-char</span> (charcode funcname)
<span class="linenr">716: </span>  (setq char-stack (cons charcode char-stack))
<span class="linenr">717: </span>  (setq func-stack (cons funcname func-stack))
<span class="linenr">718: </span>  )
<span class="linenr">719: </span>
<span class="linenr">720: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">pop-char</span> ()
<span class="linenr">721: </span>  (interactive)
<span class="linenr">722: </span>
<span class="linenr">723: </span>  (insert (car-safe char-stack))
<span class="linenr">724: </span>  (setq char-stack (cdr-safe char-stack))
<span class="linenr">725: </span>  (<span style="color: #a020f0;">if</span> (string= <span style="color: #8b2252;">"delete-char"</span> (car-safe func-stack))
<span class="linenr">726: </span>      (backward-char 1)
<span class="linenr">727: </span>    )
<span class="linenr">728: </span>  (setq func-stack (cdr-safe func-stack))
<span class="linenr">729: </span>  )
<span class="linenr">730: </span>
<span class="linenr">731: </span>(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-search-string</span>)
<span class="linenr">732: </span>
<span class="linenr">733: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">get-search-string</span> ()
<span class="linenr">734: </span>  (interactive)
<span class="linenr">735: </span>  (<span style="color: #a020f0;">if</span> (not (string= last-command <span style="color: #8b2252;">"get-search-string"</span>))
<span class="linenr">736: </span>      (setq my-search-string <span style="color: #8b2252;">""</span>))
<span class="linenr">737: </span>  (<span style="color: #a020f0;">if</span> (looking-at <span style="color: #8b2252;">"."</span>)
<span class="linenr">738: </span>      (<span style="color: #a020f0;">progn</span>
<span class="linenr">739: </span>        (setq my-search-string
<span class="linenr">740: </span>              (concat my-search-string
<span class="linenr">741: </span>                      (buffer-substring (match-beginning 0) (match-end 0))))
<span class="linenr">742: </span>        (forward-char 1)))
<span class="linenr">743: </span>  (message (concat <span style="color: #8b2252;">"Search string : "</span> my-search-string)))
<span class="linenr">744: </span>
<span class="linenr">745: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">hunt-forward</span> ()
<span class="linenr">746: </span>  (interactive)
<span class="linenr">747: </span>  (<span style="color: #a020f0;">if</span> (string= my-search-string <span style="color: #8b2252;">""</span>)
<span class="linenr">748: </span>      (scroll-up)
<span class="linenr">749: </span>    (search-forward my-search-string)
<span class="linenr">750: </span>  )
<span class="linenr">751: </span>)
<span class="linenr">752: </span>
<span class="linenr">753: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">hunt-backward</span> ()
<span class="linenr">754: </span>  (interactive)
<span class="linenr">755: </span>  (<span style="color: #a020f0;">if</span> (string= my-search-string <span style="color: #8b2252;">""</span>)
<span class="linenr">756: </span>      (scroll-down)
<span class="linenr">757: </span>      (search-backward my-search-string)
<span class="linenr">758: </span>  )
<span class="linenr">759: </span>)
<span class="linenr">760: </span>
<span class="linenr">761: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">insert-search-string</span> ()
<span class="linenr">762: </span>  (interactive)
<span class="linenr">763: </span>  (insert my-search-string)
<span class="linenr">764: </span>)
<span class="linenr">765: </span>
<span class="linenr">766: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">clear-search-string</span> ()
<span class="linenr">767: </span>  (interactive)
<span class="linenr">768: </span>  (setq my-search-string <span style="color: #8b2252;">""</span>)
<span class="linenr">769: </span>)
<span class="linenr">770: </span>
<span class="linenr">771: </span>(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">win-stack</span> nil)
<span class="linenr">772: </span>
<span class="linenr">773: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">pushw</span> ()
<span class="linenr">774: </span>  (interactive)
<span class="linenr">775: </span>  (setq win-stack (cons (current-window-configuration) win-stack)))
<span class="linenr">776: </span>
<span class="linenr">777: </span>
<span class="linenr">778: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">popw</span> ()
<span class="linenr">779: </span>  (interactive)
<span class="linenr">780: </span>  (<span style="color: #a020f0;">if</span> win-stack
<span class="linenr">781: </span>      (set-window-configuration (car-safe win-stack))
<span class="linenr">782: </span>    (message <span style="color: #8b2252;">"Window Stack is empty."</span>))
<span class="linenr">783: </span>  (setq win-stack (cdr-safe win-stack)))
<span class="linenr">784: </span>
<span class="linenr">785: </span>
<span class="linenr">786: </span><span style="color: #b22222;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">787: </span><span style="color: #b22222;">;; </span><span style="color: #b22222;">for indent</span>
<span class="linenr">788: </span><span style="color: #b22222;">;;</span>
<span class="linenr">789: </span>
<span class="linenr">790: </span><span style="color: #b22222;">;; </span><span style="color: #b22222;">pad or shrink to column using whitespace or deletion.</span>
<span class="linenr">791: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">pad-to-column</span> (column)
<span class="linenr">792: </span>  (<span style="color: #a020f0;">let</span> ((c (- column (current-column))))
<span class="linenr">793: </span>    (<span style="color: #a020f0;">while</span> (&gt; c 0)
<span class="linenr">794: </span>      (insert <span style="color: #8b2252;">" "</span>)
<span class="linenr">795: </span>      (setq c (- c 1)))
<span class="linenr">796: </span>    (delete-char c)))
<span class="linenr">797: </span>
<span class="linenr">798: </span><span style="color: #b22222;">;; </span><span style="color: #b22222;">search forward within a line by regex.</span>
<span class="linenr">799: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">re-search-within-line</span> (regex)
<span class="linenr">800: </span>  (beginning-of-line)
<span class="linenr">801: </span>  (<span style="color: #a020f0;">if</span> (re-search-forward regex (line-end-position) t)
<span class="linenr">802: </span>      <span style="color: #b22222;">;; </span><span style="color: #b22222;">point at the top of matching string.</span>
<span class="linenr">803: </span>      (goto-char (match-beginning 0))))
<span class="linenr">804: </span>
<span class="linenr">805: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">trueup-columns-region</span> (from to <span style="color: #228b22;">&amp;optional</span> prompt)
<span class="linenr">806: </span>  <span style="color: #8b2252;">"Insert addional spaces before STRs in region</span>
<span class="linenr">807: </span><span style="color: #8b2252;">to true up the tops of STRs. STR is indicated by cursor or user input.</span>
<span class="linenr">808: </span>
<span class="linenr">809: </span><span style="color: #8b2252;">for example, point the cursor at</span>
<span class="linenr">810: </span><span style="color: #8b2252;">the beginning of `=' (ether line will do).</span>
<span class="linenr">811: </span>
<span class="linenr">812: </span><span style="color: #8b2252;">  flag = true</span>
<span class="linenr">813: </span><span style="color: #8b2252;">  filename = emacs</span>
<span class="linenr">814: </span>
<span class="linenr">815: </span><span style="color: #8b2252;">becomes</span>
<span class="linenr">816: </span>
<span class="linenr">817: </span><span style="color: #8b2252;">  flag     = true</span>
<span class="linenr">818: </span><span style="color: #8b2252;">  filename = emacs"</span>
<span class="linenr">819: </span>  (interactive <span style="color: #8b2252;">"r\nP"</span>)
<span class="linenr">820: </span>  (<span style="color: #a020f0;">save-excursion</span>
<span class="linenr">821: </span>    (<span style="color: #a020f0;">let</span> ((max-column 0)
<span class="linenr">822: </span>          (reg (and (looking-at <span style="color: #8b2252;">"[</span><span style="color: #8b2252;">^</span><span style="color: #8b2252;"> \t\n0-9]+"</span>)
<span class="linenr">823: </span>                    (buffer-substring (match-beginning 0)
<span class="linenr">824: </span>                                      (match-end 0)))))
<span class="linenr">825: </span>      (<span style="color: #a020f0;">if</span> prompt (setq reg (read-from-minibuffer <span style="color: #8b2252;">"delimiter string: "</span> reg)))
<span class="linenr">826: </span>      (setq reg (regexp-quote reg))
<span class="linenr">827: </span>      <span style="color: #b22222;">;; </span><span style="color: #b22222;">find max-column</span>
<span class="linenr">828: </span>      (<span style="color: #a020f0;">save-excursion</span>
<span class="linenr">829: </span>        (goto-char from)
<span class="linenr">830: </span>        (<span style="color: #a020f0;">while</span> (and (&lt;= (point) to) (not (eobp)))
<span class="linenr">831: </span>          (<span style="color: #a020f0;">if</span> (re-search-within-line reg)
<span class="linenr">832: </span>              (setq max-column (max max-column (current-column))))
<span class="linenr">833: </span>          (forward-line 1)))
<span class="linenr">834: </span>      (message (format <span style="color: #8b2252;">"regex: %s max-column: %d"</span> reg max-column))
<span class="linenr">835: </span>      <span style="color: #b22222;">;; </span><span style="color: #b22222;">pad to colunm</span>
<span class="linenr">836: </span>      (<span style="color: #a020f0;">if</span> (&lt; 0 max-column)
<span class="linenr">837: </span>          (<span style="color: #a020f0;">save-excursion</span>
<span class="linenr">838: </span>            (goto-char from)
<span class="linenr">839: </span>            (<span style="color: #a020f0;">while</span> (and (&lt;= (point) to) (not (eobp)))
<span class="linenr">840: </span>              (<span style="color: #a020f0;">if</span> (re-search-within-line reg)
<span class="linenr">841: </span>                  (pad-to-column max-column))
<span class="linenr">842: </span>              (forward-line 1)))))))
<span class="linenr">843: </span>
<span class="linenr">844: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">trueup-columns</span> ()
<span class="linenr">845: </span>  <span style="color: #8b2252;">"Insert addional spaces before STRs in consecutive lines</span>
<span class="linenr">846: </span><span style="color: #8b2252;">to true up the tops of STRs. STR is indicated by cursor.</span>
<span class="linenr">847: </span>
<span class="linenr">848: </span><span style="color: #8b2252;">for example, point the cursor at</span>
<span class="linenr">849: </span><span style="color: #8b2252;">the beginning of `=' (ether line will do).</span>
<span class="linenr">850: </span>
<span class="linenr">851: </span><span style="color: #8b2252;">  flag = true</span>
<span class="linenr">852: </span><span style="color: #8b2252;">  filename = emacs</span>
<span class="linenr">853: </span>
<span class="linenr">854: </span><span style="color: #8b2252;">becomes</span>
<span class="linenr">855: </span>
<span class="linenr">856: </span><span style="color: #8b2252;">  flag     = true</span>
<span class="linenr">857: </span><span style="color: #8b2252;">  filename = emacs"</span>
<span class="linenr">858: </span>
<span class="linenr">859: </span>  (interactive)
<span class="linenr">860: </span>  (<span style="color: #a020f0;">save-excursion</span>
<span class="linenr">861: </span>    (<span style="color: #a020f0;">let</span> ((reg nil) (max-column 0))
<span class="linenr">862: </span>      (<span style="color: #a020f0;">if</span> (not (looking-at <span style="color: #8b2252;">"[</span><span style="color: #8b2252;">^</span><span style="color: #8b2252;"> \t\n0-9]+"</span>))
<span class="linenr">863: </span>          ()
<span class="linenr">864: </span>        (setq reg (regexp-quote (buffer-substring (match-beginning 0)
<span class="linenr">865: </span>                                                  (match-end 0))))
<span class="linenr">866: </span>        (<span style="color: #a020f0;">save-excursion</span>
<span class="linenr">867: </span>          (<span style="color: #a020f0;">while</span> (re-search-within-line reg)
<span class="linenr">868: </span>            (setq max-column (max max-column (current-column)))
<span class="linenr">869: </span>            (forward-line 1)))
<span class="linenr">870: </span>        (<span style="color: #a020f0;">while</span> (re-search-within-line reg)
<span class="linenr">871: </span>          (setq max-column (max max-column (current-column)))
<span class="linenr">872: </span>          (forward-line -1))
<span class="linenr">873: </span>        (forward-line 1) <span style="color: #b22222;">;; </span><span style="color: #b22222;">xxx</span>
<span class="linenr">874: </span>        (message (format <span style="color: #8b2252;">"regex: %s max-column: %d"</span> reg max-column))
<span class="linenr">875: </span>        (<span style="color: #a020f0;">if</span> (&lt; 0 max-column)
<span class="linenr">876: </span>            (<span style="color: #a020f0;">while</span> (re-search-within-line reg)
<span class="linenr">877: </span>              (pad-to-column max-column)
<span class="linenr">878: </span>              (forward-line 1)))))))
<span class="linenr">879: </span>
<span class="linenr">880: </span>
<span class="linenr">881: </span><span style="color: #b22222;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="linenr">882: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">replace-elements</span> (element-regexp replace-regexp to-string)
<span class="linenr">883: </span>  <span style="color: #8b2252;">"Search text element by ELEMENT-REGEXP and</span>
<span class="linenr">884: </span><span style="color: #8b2252;">  replace using REPLACE-REGEXP and TO-STRING."</span>
<span class="linenr">885: </span>  (<span style="color: #a020f0;">while</span> (re-search-forward element-regexp nil t)
<span class="linenr">886: </span>    (<span style="color: #a020f0;">save-restriction</span>
<span class="linenr">887: </span>      (narrow-to-region (match-beginning 0) (match-end 0))
<span class="linenr">888: </span>      (goto-char (point-min))
<span class="linenr">889: </span>      (replace-regexp replace-regexp to-string)
<span class="linenr">890: </span>      (goto-char (point-max)))))
<span class="linenr">891: </span>
<span class="linenr">892: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">replace-heading-to-md</span> ()
<span class="linenr">893: </span>  (interactive)
<span class="linenr">894: </span>  (replace-elements <span style="color: #8b2252;">"^\\*+ "</span> <span style="color: #8b2252;">"*"</span> <span style="color: #8b2252;">"#"</span>))
<span class="linenr">895: </span>
<span class="linenr">896: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">replace-heading-to-org</span> ()
<span class="linenr">897: </span>  (interactive)
<span class="linenr">898: </span>  (replace-elements <span style="color: #8b2252;">"^\\#+ "</span> <span style="color: #8b2252;">"#"</span> <span style="color: #8b2252;">"*"</span>))
<span class="linenr">899: </span>
<span class="linenr">900: </span>
<span class="linenr">901: </span>
<span class="linenr">902: </span><span style="color: #b22222;">;;; </span><span style="color: #b22222;">Local Variables&#58;</span>
<span class="linenr">903: </span><span style="color: #b22222;">;;; </span><span style="color: #b22222;">mode: emacs-lisp</span>
<span class="linenr">904: </span><span style="color: #b22222;">;;; </span><span style="color: #b22222;">End:</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2">todo, address, memo</h3>
<div class="outline-text-3" id="text-4-2">
<p>
特定のディレクトリにある特定のファイルを開くだけの単純な関数である．
常に書き足したり参照するファイルがあり，find-file するのが面倒な場合に重宝する．
path を制御する変数は以下の通り:
</p>

<dl class="org-dl">
<dt> mydocument-path </dt><dd>一連のファイルを置いてあるディレクトリ．デフォルトは "~/private/"
</dd>
<dt> todo-file-name, memo-file-name, address-file-name </dt><dd>それぞれのファイル名．デフォルトは、"TODO", "MEMO", "ADDRESS"
</dd>
</dl>
</div>
</div>

<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3">sum-rectangle, sum-region</h3>
<div class="outline-text-3" id="text-4-3">
<p>
あるリージョンに入っている数の合計を計算して，バッファに挿入する関数．
</p>

<pre class="example">
     リンゴ  100
     スイカ  200
     ミカン  300
</pre>

<p>
のようなバッファで、1 の所にマークを付けて，300 の後ろにポインタを置く．
そこで， <code>M-x sum-rectangle</code> を実行すると，[合計: 600] を挿入する．
<code>sum-region</code> は，矩形ではなく，リージョンについて，同様の事を行う．
</p>
</div>
</div>

<div id="outline-container-sec-4-4" class="outline-3">
<h3 id="sec-4-4">make-timetable</h3>
<div class="outline-text-3" id="text-4-4">
<p>
発表会の準備をする場合，時間を計算しながらタイムテーブルを書くことがよくある．
たとえば，以下のようなテーブルである．
</p>

<pre class="example">
14:00-14:40 発表1 (D1)
14:40-15:20 発表2 (D1)

15:20-15:45 発表3 (M2)
15:45-16:10 発表4 (M2)
16:10-16:35 発表5 (M2)
16:35-17:00 発表6 (M2)
</pre>

<p>
人数や順番の変更，1人当りの時間が変更されると，再度計算が必要になる．
これは，面倒なだけでなく，間違いが発生する原因になる．
</p>

<p>
M2 の持ち時間が、20分に変更になったとしよう．
<b>15:20</b> の <b>1</b> の上にポインタを置いて， <code>M-x make-timetable</code> を叩く．
<code>Frequency:</code> と <code>Interval:</code> 聞かれるので，20 と 0 と答えると， M2 の時間が
</p>

<pre class="example">
15:20-15:40 発表3 (M2)
15:40-16:00 発表4 (M2)
16:00-16:20 発表5 (M2)
16:20-16:40 発表6 (M2)
</pre>

<p>
のように書換えられる．開始時間を変えたければ，
15:20 をあらかじめ書換えておけばいい．Interval を指定すると，発表間にその分のギャップを入れられる．
</p>

<p>
最初にテーブルを作るときは，開始時間だけ埋めて，あとは 00:00 とでもしておけばよい．
上の例では，「D1」の後に空行を挿入してある．
これは，D1の時間だけを書換えたいのに M2 まで変わってしまわないようにするためである．
</p>
</div>
</div>
</div>


<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> (番外) セルの話</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1">(cons 'a 'b) と (cons 'a '(b)) の違いは何か</h3>
<div class="outline-text-3" id="text-5-1">
<p>
<code>[ptr1 . ptr2]</code> の形をセルという． <code>(cons x y)</code> とは，新たなセルを1つ作って， <code>ptr1</code> を <code>x</code> に <code>ptr2</code> を <code>y</code> に向けること．
</p>

<pre class="example">
1. (cons 'a 'b):    [ptr1 . ptr2] -&gt; b
                      |
                      a


2. (cons 'a '(b)):  [ptr1 . ptr2] -&gt; [pt1 . ptr2] -&gt; nil
                      |                |
                      a                b

3. '(b):            [ptr1 . ptr2] -&gt; nil
                      |
                      b
</pre>

<p>
1 は単に 2つをオブジェクトを格納する二股ポインタ． <code>(a . b)</code> と表記する．
2 はリスト構造を持っている． <code>(a b)</code> と表記する．
<code>ptr1</code> の指すオブジェクトを <code>car</code>, <code>ptr2</code> の指すオブジェクト cdr と呼ぶ．
<code>ptr</code> が指す先がセルでないとき，たとえば <code>x</code> や <code>1</code> のようなとき，<code>ptr1</code> は，atom であるという．
</p>
</div>
</div>

<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2">セルの操作の図解</h3>
<div class="outline-text-3" id="text-5-2">
</div><div id="outline-container-sec-5-2-1" class="outline-4">
<h4 id="sec-5-2-1">前に足す</h4>
<div class="outline-text-4" id="text-5-2-1">
<pre class="example">
(setq xxx '(a b c))
(setq yyy (cons 'x xxx)) ;; セルを1つ足して cdr を xxx に

このときのオブジェクトの様子:
               xxx
                |
                v
yyy -&gt; [x . -&gt;] [a . -&gt;] [b . -&gt;] [c . nil]

注意: cons cell 中に直接 x が入っているように略記している．
</pre>
</div>
</div>

<div id="outline-container-sec-5-2-2" class="outline-4">
<h4 id="sec-5-2-2">途中をいじる</h4>
<div class="outline-text-4" id="text-5-2-2">
<pre class="example">
(setcar (nthcdr 2 xxx) 'x)  ;; xxxリストの2番目のcarをxに変える

xxx -&gt; [a . -&gt;] [b . -&gt;] [x . nil]
          0        1        2
</pre>
</div>
</div>

<div id="outline-container-sec-5-2-3" class="outline-4">
<h4 id="sec-5-2-3">後に足す</h4>
<div class="outline-text-4" id="text-5-2-3">
<pre class="example">
(setcdr (nthcdr 2 xxx) (cons 'y nil)) ;; セルを1つ足して2のcdrを
                                      ;; それに向ける

xxx -&gt; [a . -&gt;] [b . -&gt;] [c . -&gt;] [y . nil]
          0        1        2
</pre>
</div>
</div>

<div id="outline-container-sec-5-2-4" class="outline-4">
<h4 id="sec-5-2-4">反転を2回して後に足す</h4>
<div class="outline-text-4" id="text-5-2-4">
<pre class="example">
(nreverse (cons 'x (nreverse xxx)))

[a . -&gt;] [b . -&gt;] [c . nil]
[a . nil] [b . &lt;-] [c . &lt;-]
[a . nil] [b . &lt;-] [c . &lt;-] [ x . &lt;-]
[a . -&gt;] [b . -&gt;] [c . -&gt;] [ x . nil]
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">&#33879;&#32773;: Yoshinari Nomura</p>
<p class="email">Email: <a href="mailto:nom@quickhack.net">nom@quickhack.net</a></p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.5.50.2 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"></p>
</div>
</body>
</html>
